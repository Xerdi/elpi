\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{elpi}[2023/11/17 Extended LaTeX Paramter Interface Package]

\RequirePackage{ifthen}
\RequirePackage{luapackageloader}
\RequirePackage{textcomp}

%\def\price{ASD}
%\def\description{ASD}

\newcommand*\paramplaceholder[1]{\texttt{\textbf{[}#1\textbf{]}}}
\newcommand*\paramnotfound[1]{\paramplaceholder{{\textnormal{\textlangle unknown\textrangle}} #1}}
\newcommand*\paramlistconjunction{,~}

\directlua{elpi = require('elpi')}

\newcommand*\strictparams{\directlua{elpi.set_strict()}}
\newcommand*%! suppress = NonMatchingIf
\ifparam[3]{\ifthenelse{\boolean{#1}}{#2}{#3}}
\newcommand*\param[1]{\directlua{elpi.param('#1')}}
\newcommand*\hasparam[3]{%
    \edef\has@param@true{#2}%
    \edef\has@param@false{#3}%
    \directlua{elpi.handle_param_is_set('#1')}}
\newcommand*\paramfield[2]{\directlua{elpi.field('#1','#2')}}
\newenvironment{paramobject}[2][\jobname]{\directlua{elpi.with_object('#2', '#1')}}{}
\newcommand*\forlistitem[3][\jobname]{\directlua{elpi.for_item('#2', '#1', '#3')}}
%\newcommand\loadcell[4]{}
\newcommand\fortablerow[3][\jobname]{\directlua{elpi.with_rows('#2', '#1', '#3')}}
\newcommand*\loadrecipe[1][]{\directlua{elpi.recipe('#1')}}
\newcommand*\loadpayload[1][]{\directlua{elpi.payload('#1')}}
