\documentclass{article}
\usepackage{gitinfo-lua}
\usepackage{elpi}
\usepackage{listings}
\usepackage{amsmath}
\usepackage{calc}

\loadrecipe[example-specification.yaml]

\setlength{\parindent}{0pt}

\makeatletter
\reversemarginpar
\@mparswitchfalse
\makeatother

\begin{document}
    \title{ELPI Example\thanks{This example corresponds to \texttt{elpi} version \gitversion{} written on \gitdate.}}
    \author{\dogitauthors[\\]}
    \maketitle

    \section*{Basics}
    Wrong parameter:\\

    \lstinline[style=TeX,morekeywords={param}]|\param{non existing}|
    $\implies$
    \param{non existing}\\

    Conditional Parameter:\\

    \lstinline[style=TeX,morekeywords={hasparam}]|\hasparam{list example}{is set}{is not set}|
    $\implies$
    \hasparam{list example}{is set}{is not set}

    \section*{Before values loaded}

    Boolean example:\\

    \lstinline[style=TeX,morekeywords={param}]|\param{bool example}|
    $\implies$
    \param{bool example}\\

    \lstinline[style=TeX,morekeywords={ifparam}]|\ifparam{bool example}{TRUE}{FALSE}|
    $\implies$
    \ifparam{bool example}{TRUE}{FALSE}\\

    String example:\\

    \lstinline[style=TeX,morekeywords={param}]|\param{string example}|
    $\implies$
    ``\param{string example}''\\

    Number example:\\

    \lstinline[style=TeX,morekeywords={param}]|\param{number example}|
    $\implies$
    \param{number example}\\

    List example:\\

    \lstinline[style=TeX,morekeywords={param}]|\param{list example}|
    $\implies$
    \param{list example}\\

    \begin{lstlisting}[language={[LaTeX]TeX},morekeywords={formatitem,forlistitem}]
\begin{enumerate}
    \newcommand\formatitem[1]{\item #1}
    \forlistitem{list example}{formatitem}
\end{enumerate}
    \end{lstlisting}
    $\implies$
    \begin{enumerate}
        \newcommand\formatitem[1]{\item #1}
        \forlistitem{list example}{formatitem}
    \end{enumerate}

    Object example:\\

    \lstinline[style=TeX,morekeywords={paramfield}]|\paramfield{object example}{name}|\\
    \lstinline[style=TeX,morekeywords={paramfield}]|\paramfield{object example}{email}|\\
    $\implies$
    \paramfield{object example}{name}
    \paramfield{object example}{email}\\

    \begin{lstlisting}[style=TeX,morekeywords={name,email}]
\newcommand\name{This will get overriden}
\begin{paramobject}{object example}
    \name{} \email{}
\end{paramobject}
% And here it works again
\name{}
    \end{lstlisting}
    $\implies$
    \newcommand\name{This will get overriden}%
    \begin{paramobject}{object example}
        \name{} \email{}
    \end{paramobject}
    \name{}\\

    Table example:\\

    \begin{lstlisting}[style=TeX,morekeywords={formatrow,fortablerow}]
\begin{tabular}{l | l}
    \textbf{Description} & \textbf{Price} \\ \hline
    \newcommand\formatrow[2]{#1 & #2 \\}%
    \fortablerow{table example}{formatrow}
\end{tabular}
    \end{lstlisting}
    $\implies$
    \newcommand\formatrow[2]{#1 & #2 \\}%
    \begin{tabular}{l | l}
        \textbf{Description} & \textbf{Price} \\ \hline
        \fortablerow{table example}{formatrow}
    \end{tabular}


    \section*{After values loaded}
    \loadpayload[example.json]

    Boolean example:\\

    \lstinline[style=TeX,morekeywords={param}]|\param{bool example}|
    $\implies$
    \param{bool example}\\

    \lstinline[style=TeX,morekeywords={ifparam}]|\ifparam{bool example}{TRUE}{FALSE}|
    $\implies$
    \ifparam{bool example}{TRUE}{FALSE}\\

    String example:\\

    \lstinline[style=TeX,morekeywords={param}]|\param{string example}|
    $\implies$
    ``\param{string example}''\\

    Number example:\\

    \lstinline[style=TeX,morekeywords={param}]|\param{number example}|
    $\implies$
    \param{number example}\\

    List example:\\

    \lstinline[style=TeX,morekeywords={param}]|\param{list example}|
    $\implies$
    \param{list example}\\

    \begin{lstlisting}[language={[LaTeX]TeX},morekeywords={formatitem,forlistitem}]
\begin{enumerate}
    \newcommand\formatitem[1]{\item #1}
    \forlistitem{list example}{formatitem}
\end{enumerate}
    \end{lstlisting}
    $\implies$
    \begin{enumerate}
        \newcommand\formatitem[1]{\item #1}
        \forlistitem{list example}{formatitem}
    \end{enumerate}

    Object example:\\

    \lstinline[style=TeX,morekeywords={paramfield}]|\paramfield{object example}{name}|\\
    \lstinline[style=TeX,morekeywords={paramfield}]|\paramfield{object example}{email}|\\
    $\implies$
    \paramfield{object example}{name}
    \paramfield{object example}{email}\\

    \begin{lstlisting}[style=TeX,morekeywords={name,email}]
\newcommand\name{This will get overriden}
\begin{paramobject}{object example}
    \name{} \email{}
\end{paramobject}
% And here it works again
\name{}
    \end{lstlisting}
    $\implies$
    \begin{paramobject}{object example}
        \name{} \email{}
    \end{paramobject}
    \name{}\\

    Table example:\\

    \begin{lstlisting}[style=TeX,morekeywords={formatrow,fortablerow}]
\begin{tabular}{l | l}
    \textbf{Description} & \textbf{Price} \\ \hline
    \newcommand\formatrow[2]{#1 & #2 \\}%
    \fortablerow{table example}{formatrow}
\end{tabular}
    \end{lstlisting}
    $\implies$
    \begin{tabular}{l | l}
        \textbf{Description} & \textbf{Price} \\ \hline
        \fortablerow{table example}{formatrow}
    \end{tabular}

    \section*{Specification File}
    \lstinputlisting[language=YAML,numbers=left,xleftmargin=15pt,caption={example-specification.yaml}]{example-specification.yaml}


    \section*{Payload File}
    \lstinputlisting[language=YAML,numbers=left,xleftmargin={15pt},caption={example.yaml}]{example.yaml}

    \section*{Fallback Payload}
    \lstinputlisting[language=JSON,numbers=left,xleftmargin={15pt},caption={example.json}]{example.json}
\end{document}
